@{
    ViewData["Title"] = "Course Training";
    ViewData["MainTitle"] = "I-Manage";
    Layout = "~/Views/Shared/_Layout.cshtml";
} 
<div class="panel panel-primary" style="margin-top:-15px;width:100%;">
    <div class="panel panel-default" style="width:100%;border-width:thin;border-style:solid;">
        <div class="panel-body" style="width:100%;">
            <form method="post">
                @Html.AntiForgeryToken()
                <div class="form-horizontal" style="margin-top:25px">
                    <div class="row form-group">
                        <div class="col-sm-2 col-md-2">
                            <span class="pull-right">
                                <label class="LabelCaption">Course ID</label>
                            </span>
                        </div>
                        <div class="col-sm-4 col-md-4">
                            <input type="text" id="txtFilterCourseID" class="form-control input-sm" />
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-sm-2 col-md-2">
                            <span class="pull-right">
                                <label class="LabelCaption">Course Name</label>
                            </span>
                        </div>
                        <div class="col-sm-4 col-md-4">
                            <input type="text" id="txtFilterCoursemName" class="form-control input-sm" />
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-sm-2 col-md-2">
                            <span class="pull-right">
                                <label class="LabelCaption">Course Status</label>
                            </span>
                        </div>
                        <div class="col-4">
                            <div class="btn-group">
                                <select id="selectCourseStatus" name="selectCourseStatus" class="form-control" style="width: 100%">
                                    <option value="">@LDMS.WEB.Resources.Enum.e_Select_All</option>
                                    <option value="1">@LDMS.WEB.Resources.Enum.e_Status_Active</option>
                                    <option value="0">@LDMS.WEB.Resources.Enum.e_Status_Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="col-sm-2 col-md-2">
                            <span class="pull-right">
                                <label class="LabelCaption">Learn Method</label>
                            </span>
                        </div>
                        <div class="col-4">
                            <div class="btn-group">
                                <select id="selectLearnMethod" name="selectLearnMethod" class="form-control" style="width: 100%">
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row form-group">
                        <div class="col-sm-2 col-md-2 offset-8">
                            <a id="btnSeacrh" class="btn btn-outline-secondary waves-effect waves-light" style="width:70%" onclick="Search()">
                                <img style="width:25px;height:20px" src="~/assets/images/svg/icon-seach.svg" />&nbsp;&nbsp;Search
                            </a>
                        </div>
                        <div class="col-sm-2 col-md-2" style="margin-left:-25px">
                            <a id="btnAdd" onclick="window.location.href = '@Url.Action("Add", "Courses")';" class="btn btn-outline-success waves-effect waves-light" style="width:90%;">
                                <img style="width:25px;height:20px" src="~/assets/images/svg/add-button-circle.svg" />&nbsp;&nbsp;Add Course
                            </a>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="table-responsive m-t-40">
        <table class="display dataTable" width="100%" id="dtCourseList">
            <thead>
                <tr>
                    <th style="text-align:center;width:100px">No</th>
                    <th style="text-align:center;width:150px">Course ID</th>
                    <th style="text-align:center;width:150px">Course Name</th>
                    <th style="text-align:center;width:150px">Learn Method</th>
                    <th style="text-align:center;width:150px">Course Status</th>
                    <th style="text-align: center;width:50px">Edit</th>
                    <th style="text-align:center;width:50px">Delete</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

</div>
@section Scripts{
    <style type="text/css">
        .form-group {
            margin-bottom: 1.5rem;
        }
    </style>

    <script type="text/javascript">

         $(document).ready(function () {

             LoadCourseLearnMethod();
             Search();
         });


        function LoadCourseLearnMethod() {
           $('#selectLearnMethod').empty();
                 $.ajax({
                url: "/Courses/GetAllCourseLearnMethod",
                type: "GET",
                    }).done(function (items) {
                        var options = $('#selectLearnMethod');
                        options.append($("<option />").val(null).text("--- Select All---"));
                        $.each(items, function () {
                            options.append($("<option />").val(this.ID).text(this.Course_LearnMethodName_EN));
                        });
                        $('select[name="selectLearnMethod"]').val(null);
                    });
        }


        function Search() {
            //alert('search function');
             //MessageController.BlockUI({ boxed: true, target: '#dtCourseList' });
             dtData = $('#dtCourseList').DataTable({
                 'processing': true,
                 'serverSide': true,
                 'paging': true,
                 "ordering": true,
                 "searching": false,
                 "lengthChange": false,
                 "bAutoWidth": false,
                 "Filter": false,
                 "info": false,
                 "bPaginate": false,
                 "bLengthChange": false,
                 //"language": {
                 //    "lengthMenu": "Display _MENU_ records per page",
                 //    "zeroRecords": "    Nothing found - sorry",
                 //    "info": "    page _PAGE_ of _PAGES_",
                 //    "infoEmpty": "    No records available",
                 //    "infoFiltered": "(filtered from _MAX_ total records)"
                 //},
                 "bJQueryUI": true, //Enable smooth theme
                 "sPaginationType": "full_numbers", //Enable smooth theme
                 "sDom": 'lfrtip',
                 //retrieve: true,
                 destroy: true,
                'ajax': {
                    'url': '@Url.Action("Search", "Courses")',
                    'type': 'POST',
                    'data': {
                        'CourseID': $("#txtFilterCourseID").val(),
                        'CourseName': $("#txtFilterCourseName").val(),
                        'CourseStatus': $("#selectCourseStatus").val(),
                        'LearnMethod': $("#selectLearnMethod").val(),
                        "__RequestVerificationToken": $('input[name=__RequestVerificationToken]').val()
                    },
                },
                'columns': [
                    { data: 'rownumber' },
                    { data: 'CourseID' },
                    { data: 'CourseName' },
                    { data: 'Course_LearnMethodName_EN' },
                    { data: 'CourseStatus' },
                    {
                        "mData": "ID",
                        "mRender": function (data, type, row) {
                            var url = '@Url.Content("~/Courses/Detail/")'+data;
                            var icon = '@Url.Content("~/assets/images/svg/icon-edit-blue.svg")';
                            return "<a href='"+url+"'><img src='"+icon+"' class='light-logo' alt='homepage' /></a>";
                        }
                    },
                    {
                        "mData": "ID",
                        "mRender": function (data, type, row) {
                            //return "<a href='#'><img src='@Url.Content("~/assets/images/svg/icon-delete-red.svg")' class='light-logo' alt='homepage' /></a>";
                            var name = row['CourseName'];
                            return "<a href='#' onclick=\"DeleteCourse('"+data+"','"+name+"')\"'><img src='@Url.Content("~/assets/images/svg/icon-delete-red.svg")' class='light-logo' alt='homepage' /></a>";
                        }
                        
                    }

                 ],
                 "columnDefs": [
                     { "orderable": false, "targets": 0, "className": "text-center", "width": "4%" },
                     { "orderable": true, "targets": 1, "className": "text-center" },
                     { "orderable": true, "targets": 2, "className": "text-center" },
                     { "orderable": true, "targets": 3, "className": "text-center" },
                     { "orderable": true, "targets": 4, "className": "text-center" },
                     { "orderable": false, "targets": 5, "className": "text-center" },
                     { "orderable": false, "targets": 6, "className": "text-center" },
                     //{ "orderable": false, "targets": 7, "className": "text-center" }

                 ]
             });
        }

        function DeleteCourse(ID, name) {
             MessageController.ConfirmCallback("Are you sure you want to delete Course '" + name + "' ?", "Confirm Delete!", function (res) {
            if (res) {
                $.ajax({
                    url: "/Courses/DeleteCourse",
                    type: "Post",
                    data: {
                        ID_Course: ID

                    },
                    success: function (e) {
                        Search();
                    },

                }
                )
            }
        });
    }

    </script>
}